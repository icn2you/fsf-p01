<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <title>Youtube MVP</title>
  </head>

  <body>
    <div id='videos'>
    </div>

    <script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
      gapi.load('client', function () {
        var recipePromise = Promise.resolve({
          title: 'cabbage'
        });

        var gapiPromise = gapi.client.init({
          'apiKey': 'AIzaSyDVgTFx7uDlEb5Dw0KQ0EuCVJBb83ZpaKM'
        }).then(function() {
          return gapi.client.load("https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest")
            .then(function() { console.log("Youtube API Client loaded"); },
                  function(err) { console.error("Error loading Youtube API Client: ", err); });
        })
        
        Promise.all([recipePromise, gapiPromise]).then(function(values) {
          var recipe = values[0];
          var keyword = recipe.title;

          return gapi.client.youtube.search.list({
            part: "snippet",
            q: keyword,
            topicId: "/m/02wbm",
            order: "relevance",
            maxResults: 3
          })
        }).then(function(response) {
          console.log("Response successful: ");
          var videos = response.result.items;

          videos.forEach(function(video) {
            // create an <iframe> for each video
            // src url should be https://youtube.com/embed/VIDEO_ID
            // append the video to the 'videos' div
            console.log(video.id.videoId);
            $("#videos").append(`<iframe src="https://youtube.com/embed/${video.id.videoId}">`)
          })
        }).catch(function(error) {
          console.log("Error searching: ", error)
        })
      });
    </script>
  </body>
</html> 